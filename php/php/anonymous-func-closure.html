<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>匿名函数和回调函数和闭包类 | GooPuu</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="技术、前端技术，整理技术文档">
    
    <link rel="preload" href="/assets/css/0.styles.5be624d7.css" as="style"><link rel="preload" href="/assets/js/app.a2be46e1.js" as="script"><link rel="preload" href="/assets/js/2.c4a55d75.js" as="script"><link rel="preload" href="/assets/js/62.735d9878.js" as="script"><link rel="prefetch" href="/assets/js/10.00d50cc6.js"><link rel="prefetch" href="/assets/js/11.116edcd9.js"><link rel="prefetch" href="/assets/js/12.8d813279.js"><link rel="prefetch" href="/assets/js/13.cf20dfe4.js"><link rel="prefetch" href="/assets/js/14.9240ee25.js"><link rel="prefetch" href="/assets/js/15.6f2e36ad.js"><link rel="prefetch" href="/assets/js/16.31963ec0.js"><link rel="prefetch" href="/assets/js/17.1a990a93.js"><link rel="prefetch" href="/assets/js/18.25649302.js"><link rel="prefetch" href="/assets/js/19.f501b2b3.js"><link rel="prefetch" href="/assets/js/20.d950bcb4.js"><link rel="prefetch" href="/assets/js/21.682698e1.js"><link rel="prefetch" href="/assets/js/22.21b445b2.js"><link rel="prefetch" href="/assets/js/23.d400bd60.js"><link rel="prefetch" href="/assets/js/24.2d52e7c6.js"><link rel="prefetch" href="/assets/js/25.b5c2bf83.js"><link rel="prefetch" href="/assets/js/26.9e575ce0.js"><link rel="prefetch" href="/assets/js/27.78bcdcb3.js"><link rel="prefetch" href="/assets/js/28.3d13414a.js"><link rel="prefetch" href="/assets/js/29.4c76408b.js"><link rel="prefetch" href="/assets/js/3.c6d7fc3c.js"><link rel="prefetch" href="/assets/js/30.72837135.js"><link rel="prefetch" href="/assets/js/31.ec3acd91.js"><link rel="prefetch" href="/assets/js/32.7ab63353.js"><link rel="prefetch" href="/assets/js/33.243ce462.js"><link rel="prefetch" href="/assets/js/34.cbed375d.js"><link rel="prefetch" href="/assets/js/35.f8989dec.js"><link rel="prefetch" href="/assets/js/36.8ba39ddf.js"><link rel="prefetch" href="/assets/js/37.dda1b25a.js"><link rel="prefetch" href="/assets/js/38.d25ba1f6.js"><link rel="prefetch" href="/assets/js/39.1ec1d519.js"><link rel="prefetch" href="/assets/js/4.2176f0d8.js"><link rel="prefetch" href="/assets/js/40.94973a05.js"><link rel="prefetch" href="/assets/js/41.e12f4c7d.js"><link rel="prefetch" href="/assets/js/42.46323141.js"><link rel="prefetch" href="/assets/js/43.711ab579.js"><link rel="prefetch" href="/assets/js/44.f645cc5a.js"><link rel="prefetch" href="/assets/js/45.73afa142.js"><link rel="prefetch" href="/assets/js/46.91a9b3ad.js"><link rel="prefetch" href="/assets/js/47.9a2a9d74.js"><link rel="prefetch" href="/assets/js/48.737f52e3.js"><link rel="prefetch" href="/assets/js/49.ecab2c21.js"><link rel="prefetch" href="/assets/js/5.91c18d5d.js"><link rel="prefetch" href="/assets/js/50.24ce14d6.js"><link rel="prefetch" href="/assets/js/51.5abcf9b3.js"><link rel="prefetch" href="/assets/js/52.69567ee5.js"><link rel="prefetch" href="/assets/js/53.1f658822.js"><link rel="prefetch" href="/assets/js/54.c690ae41.js"><link rel="prefetch" href="/assets/js/55.4eb95d0d.js"><link rel="prefetch" href="/assets/js/56.8c782afd.js"><link rel="prefetch" href="/assets/js/57.206d39f5.js"><link rel="prefetch" href="/assets/js/58.92f0ff0c.js"><link rel="prefetch" href="/assets/js/59.2dd1e634.js"><link rel="prefetch" href="/assets/js/6.537e369f.js"><link rel="prefetch" href="/assets/js/60.53f4090e.js"><link rel="prefetch" href="/assets/js/61.6c93bf75.js"><link rel="prefetch" href="/assets/js/63.ccb65206.js"><link rel="prefetch" href="/assets/js/64.5fe06553.js"><link rel="prefetch" href="/assets/js/65.f65b3817.js"><link rel="prefetch" href="/assets/js/66.633ff33c.js"><link rel="prefetch" href="/assets/js/67.b7812b8c.js"><link rel="prefetch" href="/assets/js/68.910f070e.js"><link rel="prefetch" href="/assets/js/69.f0a0f76d.js"><link rel="prefetch" href="/assets/js/7.f36c84d3.js"><link rel="prefetch" href="/assets/js/70.c2294a03.js"><link rel="prefetch" href="/assets/js/71.3c572e74.js"><link rel="prefetch" href="/assets/js/72.c8089ef4.js"><link rel="prefetch" href="/assets/js/73.2e863aa4.js"><link rel="prefetch" href="/assets/js/74.95087ea4.js"><link rel="prefetch" href="/assets/js/8.b0d0596a.js"><link rel="prefetch" href="/assets/js/9.6c11348f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5be624d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GooPuu</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语法基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/basic.html" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/css/basic.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/javascript/basic.html" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          基础提升
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/promote.html" class="nav-link">
  HTML 中的关注点
</a></li><li class="dropdown-subitem"><a href="/css/promote.html" class="nav-link">
  CSS 酷炫特效
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/front-end-project.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/git/introduce.html" class="nav-link">
  GIT
</a></div><div class="nav-item"><a href="/npm.html" class="nav-link">
  NPM
</a></div><div class="nav-item"><a href="/webpack/introduce.html" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/sass.html" class="nav-link">
  Sass
</a></div><div class="nav-item"><a href="/vue.html" class="nav-link">
  Vue2
</a></div><div class="nav-item"><a href="/uniapp.html" class="nav-link">
  uniapp
</a></div><div class="nav-item"><a href="/ssr.html" class="nav-link">
  SSR
</a></div><div class="nav-item"><a href="/serverless.html" class="nav-link">
  ServerLess
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PHP" class="dropdown-title"><span class="title">PHP</span> <span class="arrow down"></span></button> <button type="button" aria-label="PHP" class="mobile-dropdown-title"><span class="title">PHP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/php/php/anonymous-func-closure.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/php/ci3/entrance.html" class="nav-link">
  CodeIgnier3
</a></li><li class="dropdown-item"><!----> <a href="/php/laravel8/index.html" class="nav-link">
  Laravel8
</a></li></ul></div></div><div class="nav-item"><a href="/nginx.html" class="nav-link">
  Nginx
</a></div><div class="nav-item"><a href="/mysql.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/linux.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/docker.html" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="/opensource.html" class="nav-link">
  开源项目
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语法基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/basic.html" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/css/basic.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/javascript/basic.html" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          基础提升
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/promote.html" class="nav-link">
  HTML 中的关注点
</a></li><li class="dropdown-subitem"><a href="/css/promote.html" class="nav-link">
  CSS 酷炫特效
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/front-end-project.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/git/introduce.html" class="nav-link">
  GIT
</a></div><div class="nav-item"><a href="/npm.html" class="nav-link">
  NPM
</a></div><div class="nav-item"><a href="/webpack/introduce.html" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/sass.html" class="nav-link">
  Sass
</a></div><div class="nav-item"><a href="/vue.html" class="nav-link">
  Vue2
</a></div><div class="nav-item"><a href="/uniapp.html" class="nav-link">
  uniapp
</a></div><div class="nav-item"><a href="/ssr.html" class="nav-link">
  SSR
</a></div><div class="nav-item"><a href="/serverless.html" class="nav-link">
  ServerLess
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PHP" class="dropdown-title"><span class="title">PHP</span> <span class="arrow down"></span></button> <button type="button" aria-label="PHP" class="mobile-dropdown-title"><span class="title">PHP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/php/php/anonymous-func-closure.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/php/ci3/entrance.html" class="nav-link">
  CodeIgnier3
</a></li><li class="dropdown-item"><!----> <a href="/php/laravel8/index.html" class="nav-link">
  Laravel8
</a></li></ul></div></div><div class="nav-item"><a href="/nginx.html" class="nav-link">
  Nginx
</a></div><div class="nav-item"><a href="/mysql.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/linux.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/docker.html" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="/opensource.html" class="nav-link">
  开源项目
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GIT</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NPM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Sass</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue2.x</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>uniapp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SSR</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ServeLess</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PHP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/php/php/anonymous-func-closure.html" aria-current="page" class="active sidebar-link">匿名函数和回调函数和闭包类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_1-匿名函数-anonymous-function" class="sidebar-link">1. 匿名函数（anonymous function）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_1-1-什么是匿名函数" class="sidebar-link">1.1 什么是匿名函数？</a></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_1-2-匿名函数的用法" class="sidebar-link">1.2 匿名函数的用法</a></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_1-3-匿名函数从父作用域中继承变量" class="sidebar-link">1.3 匿名函数从父作用域中继承变量</a></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_1-4-类中的闭包" class="sidebar-link">1.4 类中的闭包</a></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_1-5-匿名函数的应用场景" class="sidebar-link">1.5 匿名函数的应用场景？</a></li></ul></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_2-闭包类-closure" class="sidebar-link">2. 闭包类（Closure）</a></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_3-回调函数-callback" class="sidebar-link">3. 回调函数（callback）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_3-1-什么是回调-回调函数" class="sidebar-link">3.1 什么是回调，回调函数？</a></li><li class="sidebar-sub-header"><a href="/php/php/anonymous-func-closure.html#_3-2-回调的意义-使用场景" class="sidebar-link">3.2 回调的意义，使用场景？</a></li></ul></li></ul></li><li><a href="/php/php/exception-error.html" class="sidebar-link">异常和错误处理</a></li><li><a href="/php/php/composer.html" class="sidebar-link">Composer 自动加载</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CodeIgniter3</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-匿名函数-anonymous-function"><a href="#_1-匿名函数-anonymous-function" class="header-anchor">#</a> 1. 匿名函数（<code>anonymous function</code>）</h2> <h3 id="_1-1-什么是匿名函数"><a href="#_1-1-什么是匿名函数" class="header-anchor">#</a> 1.1 什么是匿名函数？</h3> <p>匿名函数：也叫闭包函数，一个临时创建的、没有名称的函数。</p> <p><code>PHP</code> 中匿名函数，是通过 <code>Closure 类</code>实现的。</p> <h3 id="_1-2-匿名函数的用法"><a href="#_1-2-匿名函数的用法" class="header-anchor">#</a> 1.2 匿名函数的用法</h3> <h4 id="_1-2-1-作为特殊的临时函数"><a href="#_1-2-1-作为特殊的临时函数" class="header-anchor">#</a> 1.2.1 作为特殊的临时函数</h4> <p>这是它最基本的用法，临时创建的一个函数，调用上下文结束则丢失。</p> <h4 id="_1-2-2-作为变量值"><a href="#_1-2-2-作为变量值" class="header-anchor">#</a> 1.2.2 作为变量值</h4> <p>这个意义就很大了，有点和 <code>JavaScript</code> 中的函数类似了。<br>
可以把匿名函数当做一个变量值，那么：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$myFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string single-quoted-string">'hello world'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>作为变量值，匿名函数末尾应该有一个“分号”标识语句结束。</p></div> <h3 id="_1-3-匿名函数从父作用域中继承变量"><a href="#_1-3-匿名函数从父作用域中继承变量" class="header-anchor">#</a> 1.3 匿名函数从父作用域中继承变量</h3> <p>在 <code>JavaScript</code> 中，闭包自动继承父作用域中的变量，根据其作用域链可以访问外层父作用域的变量，但是在 <code>PHP</code> 中，需要手动的导入才能真的引用父作用域变量。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'hello world'</span><span class="token punctuation">;</span>

<span class="token variable">$myFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>注意，虽然可以导入父作用域的变量，但是不能导入 <code>$this</code> 和超全局变量（比如 <code>$GLOBALS</code>, <code>$_SERVER</code>...）。</p></div> <h3 id="_1-4-类中的闭包"><a href="#_1-4-类中的闭包" class="header-anchor">#</a> 1.4 类中的闭包</h3> <p><strong>作为普通的闭包时，内部自动绑定类上下文：<code>$this</code>：</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$anonyFunc</span> <span class="token operator">=</span> <span class="token variable">$instance</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$anonyFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// 这里会打印出 $instance 对象信息</span>
</code></pre></div><p><strong>静态匿名函数，不绑定对象：</strong><br>
如果要让匿名函数与当前对象隔离，可以将匿名函数声明为静态的：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token keyword">static</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 此时打印会发现，它将 $this 当做一个普通的变量来处理了，报错说找不到 this 这个变量名</span>
</code></pre></div><h3 id="_1-5-匿名函数的应用场景"><a href="#_1-5-匿名函数的应用场景" class="header-anchor">#</a> 1.5 匿名函数的应用场景？</h3> <p>作为回调函数，作为作用域特定的功能块都是匿名函数的应用场景。</p> <h2 id="_2-闭包类-closure"><a href="#_2-闭包类-closure" class="header-anchor">#</a> 2. 闭包类（<code>Closure</code>）</h2> <p>匿名函数是闭包类的实现，也就是说，闭包类实例化创建的对象就是匿名函数，匿名函数就是闭包类的实例。因此匿名函数也称闭包函数。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Closure</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> statis <span class="token function">bind</span><span class="token punctuation">(</span><span class="token variable">$closure</span><span class="token punctuation">,</span> <span class="token variable">$new_this</span><span class="token punctuation">,</span> <span class="token variable">$new_scopre</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token function">bindTo</span><span class="token punctuation">(</span><span class="token variable">$new_this</span><span class="token punctuation">,</span> <span class="token variable">$new_scopre</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> statis <span class="token function">fromCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这就是闭包类的大致结构。从它的结构中，得到一些闭包（匿名函数）的功能：</p> <ul><li>首先闭包类不能实例化</li> <li><code>static bind()</code>、<code>bindTo()</code>，用特定的绑定对象和类作用域复制闭包</li> <li><code>call()</code>，绑定并调用闭包</li> <li><code>fromCallable()</code>，将参数中的回调转换为闭包</li></ul> <p><strong>解析 <code>bindTo()</code>：</strong></p> <ul><li><code>$new_this</code>：是一个对象，将该对象绑定到闭包中的 <code>$this</code>，也就是说，在这之后的闭包调用中，<code>$this</code> 就指代了这个对象</li> <li><code>$new_scrope</code>：类作用域，即闭包中 <code>$this</code> 的作用域
<ul><li>默认值 <code>static</code>，表示保持不变，那么如果保持不变，对于此时闭包中的 <code>$this</code>来说，它指代了第一个参数的对象，那么此时对象访问类属性，只能访问公有成员，私有属性和保护属性是不能访问的</li> <li>传入对象，或者类名，表示闭包中 <code>$this</code> 具有“在当前类内部”一样的效果，那么既然在类内部，<code>$this</code>肯定可以访问任意可见性的成员（因为就算是私有的成员，也可以在当前类中访问）</li></ul></li></ul> <p>示例：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'goopuu'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$fn1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token variable">$fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">age</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token variable">$instance</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$copyFn1</span> <span class="token operator">=</span> <span class="token variable">$fn1</span><span class="token operator">-&gt;</span><span class="token function">bindTo</span><span class="token punctuation">(</span><span class="token variable">$instance</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$copyFn2</span> <span class="token operator">=</span> <span class="token variable">$fn2</span><span class="token operator">-&gt;</span><span class="token function">bindTo</span><span class="token punctuation">(</span><span class="token variable">$instance</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
    报错，致命错误：Fatal error: Cannot access private property Foo::$name 
    很明显，不能访问私有属性
    解析：在复制闭包时，仅仅绑定了闭包内部 $this 指向的对象为 new Foo() 即 $instance，
    那么此时闭包内部的 $this 就相当于 $instance，
    那么 $this-&gt;name  就相当于 $instance-&gt;name，显然，外部对象不能访问私有成员
*/</span>
<span class="token keyword">echo</span> <span class="token variable">$copyFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span> 


<span class="token keyword">echo</span> <span class="token variable">$copyFn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 正确输出 10</span>

<span class="token comment">// 修改代码：</span>
<span class="token variable">$copyFn1</span> <span class="token operator">=</span> <span class="token variable">$fn1</span><span class="token operator">-&gt;</span><span class="token function">bindTo</span><span class="token punctuation">(</span><span class="token variable">$instance</span><span class="token punctuation">,</span> <span class="token variable">$instance</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
<span class="token variable">$copyFn1</span> <span class="token operator">=</span> <span class="token variable">$fn1</span><span class="token operator">-&gt;</span><span class="token function">bindTo</span><span class="token punctuation">(</span><span class="token variable">$instance</span><span class="token punctuation">,</span> <span class="token class-name static-context">Foo</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
    此时，正确输出 goopuu
    解析：在复制闭包时，绑定了对象，那么闭包中的 $this 相当于 $instance，而且同时绑定了类所用于为 $sintance 或者
    Foo::class，那么闭包中的 $this 任然相当于 $instance，但是这个对象是在类内部创建的，也就是说此时相当于 self，
    那么在类内部，self 可以访问任意控制修饰符的成员，因此此时就算是私有成员也能访问
*/</span>
<span class="token keyword">echo</span> <span class="token variable">$copyFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
</code></pre></div><p>得到结论：复制闭包时，如果需要访问内部的私有的、受保护的成员，则需要第二个参数。<br>
至于 <code>bind()</code>，是 <code>bindTo()</code> 的静态操作，注意静态操作不能通过对象调用了，需要类名::静态成员方式调用。<br>
复制闭包，在现代框架中很常见，比如 <code>Laravel</code> 底层大量使用。</p> <p><strong>解析 <code>call()</code>：</strong><br>
要求：<code>PHP7, PHP8</code>，预留。</p> <p><strong>解析 <code>fromCallable()</code>：</strong><br>
要求：<code>PHP &gt;= 7.1.0</code>，预留。</p> <h2 id="_3-回调函数-callback"><a href="#_3-回调函数-callback" class="header-anchor">#</a> 3. 回调函数（<code>callback</code>）</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>匿名函数（闭包），在 <code>PHP</code> 中，最常用的场景就是用作“回调”。</p></div> <h3 id="_3-1-什么是回调-回调函数"><a href="#_3-1-什么是回调-回调函数" class="header-anchor">#</a> 3.1 什么是回调，回调函数？</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>在 <code>PHP</code> 中，回调函数有一个特殊的类型：<code>callabck</code>。</p></div> <p><strong>所谓回调（回调函数）：把一个函数当做参数传递给其他函数（执行函数、主函数），并在其他函数（执行函数、主函数）中“能够自动调用”这个传递的函数，称这个被传入的函数为回调函数或回调。</strong></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>“能够自动调用”，而不是“一定会自动调用”，需要根据执行函数体内的逻辑，看是否触发回调。</p></div> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">callback</span> <span class="token variable">$c</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$c</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">myPlus</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">,</span> <span class="token variable">$y</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$x</span> <span class="token operator">+</span> <span class="token variable">$y</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">echo</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'myPlus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
</code></pre></div><p><strong>回调函数，可以使用“字符串”的形式作为参数传入，比如内置函数（非语言结构）名、自定义函数名、类方法名、类静态方法名，也可以使用匿名函数、箭头函数（<code>PHP7.4</code>开始支持）形式作为参数传入。</strong></p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>上述说的“非语言结构”，在 <code>PHP</code> 中，有一些语言结构和函数的用法一样的，比如 <code>array(), echo, empty(), exit(), evil(), isset(), list(), print, unset()</code>。</p> <p>回调函数参数：回调函数参数通过执行函数体的内部回调时传入实参。</p></div> <h3 id="_3-2-回调的意义-使用场景"><a href="#_3-2-回调的意义-使用场景" class="header-anchor">#</a> 3.2 回调的意义，使用场景？</h3> <p>从语法结构上看回调就像条件判断语句、像分支语句、像独立功能块，从应用来看，它像“钩子”、像“信号”。在执行函数体的一些地方打上钩子，当触发这个钩子时，会主动实现回调，否则略过。<br>
常见的应用场景：</p> <ul><li>作为条件分支结构：<code>JavaScript</code> 中大量的回调，比如 <code>ajax</code> 请求后，会有一个成功的回调，还有失败的回调，根据结果触发相应的回调</li> <li>作为单独功能块，比如 <code>preg_replace_callback</code>，使用一个独立的功能块回调返回最终结果</li> <li>异步执行<br>
我个人从这三个层面去关注回调的使用场景。<br>
针对最后一种异步执行，这很适用，但是 <code>PHP</code> 来实现有点难，因为异步回调，一定需要支持多进程、多线程才能实现，类似这样的效果：执行函数中回调时，回调直接返回，执行函数此时就不会阻塞然后继续后续的执行，然而回调函数返回并不是结束而是需要开启一个新的进程执行，等到真的执行完成，再通过一定的方法通知原执行函数（这点就很难了），当然也不一定非要通知，可能回调就是一个独立的功能完成一定的操作，然后释放进程。<br> <strong>这里留一个作业：参考 <code>Node</code>、<code>JavaScript</code>中实现异步操作的方式，看最终能不能在 <code>PHP</code> 中实现异步操作。</strong></li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>目前，在 <code>PHP</code> 中考虑回调，就仅考虑同步执行的场景，那么 <code>PHP</code> 中的回调起到的作用就比较局限了，主要作为独立功能块来应用。</p></div> <div class="custom-block warning"><p class="custom-block-title">综述</p> <p>从上述中得到一个结论：如果执行函数结果未知，但是可以预见，那么可以通过回调的方式实现其他函数的调用。</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sass.html" class="prev">
        Sass
      </a></span> <span class="next"><a href="/php/php/exception-error.html">
        异常和错误处理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a2be46e1.js" defer></script><script src="/assets/js/2.c4a55d75.js" defer></script><script src="/assets/js/62.735d9878.js" defer></script>
  </body>
</html>
